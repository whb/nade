<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>网络攻防演练监控屏幕</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
  <link rel="shortcut icon" href="/static/images/favicon.ico">
  <!--[if lte IE 8]><meta http-equiv="refresh" content="0;url=/ie" /><![endif]-->
  
  <link rel="stylesheet" href="/static/css/bootstrap.min.css">
  <link rel="stylesheet" href="/static/css/font-awesome.min.css">
  <link rel="stylesheet" href="/static/css/main.css">
  <script src="/static/js/echarts.min.js"></script>
  <script src="/static/js/map/china.js"></script> 
  <script src="/static/js/jquery-3.2.1.min.js"></script> 
  <script src="/static/js/bootstrap.min.js"></script>
</head>

<body class="container-fluid">
    <div class="col-md-12">
      <div class="row">
        <div id="main" style="height:1080px;"></div>
      </div>
    </div>
    
    <div class="col-md-3 chart_column">
    </div>

    <div class="col-md-3 text_column" >
      <div class="intro">
      <h2><span class="label label-primary">3</span> 页面篡改攻击</h2>
      <p>天津某基础电信企业官网主页出现虚假信息，官网后台服务器遭受过口令破解攻击进而导致官网页面被篡改，攻击端IP来自河北某基础电信企业。  </p>
      </div>
      
      <div class="alarm">
      <h2 id="alarm_text"></h2>
      </div>
      
      <div class="defense">
      <h2 id="defense_text"></h2>
      </div>
    </div>
    
<div id="alarmModal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <h1 class="alarm"><i class="fa fa-exclamation-triangle fa-lg" aria-hidden="true"></i>&nbsp;&nbsp;警报</h1>
        <h1>发现网页篡改!!!</h1>
      </div>
    </div>
</div>
</body>


<script type="text/javascript">
var alarmModal = $('#alarmModal').on('shown.bs.modal', function () {
  clearTimeout(alarmModal.data('hideInteval'))
  var id = setTimeout(function(){
      alarmModal.modal('hide');
  }, 8000);
  alarmModal.data('hideInteval', id);
})
</script> 
<script type="text/javascript">
var pageStatus = {
	status: 'initial',
	attackArea: '河北',
	targetArea: '天津',
	alarm_text: '',
	chart_image: ''
};
</script> 
<script src="/echarts/webpage.js"></script> 
<script type="text/javascript">
var attackChart = echarts.init(document.getElementById('main'));
attackChart.setOption(moveOption);

$(window).resize(function() {
  attackChart.resize();
});

var webpageApi = "/api/webpage.json";
function getWebpageJsonAndRedraw() {
  $.getJSON(webpageApi, function( result ) {
    if(pageStatus.status == result.status) {
		return;
    }
    
    pageStatus = result;
    
    if(result.status == 'attack') {
      redrawChart();
      $('#alarm_text').html(result.alarm_text);
    } else if(result.status == 'alarm') {
      $('#alarmModal').modal('show');
      $('#alarm_text').html(result.alarm_text);
      // show distort_webpage.jpg
    } else if(result.status == 'analyze') {
      $('#defense_text').html(result.defense_text);
    } else if(result.status == 'repair') {
      $('#defense_text').html(result.defense_text);
      $('#alarm_text').html('');
    } else if(result.status == 'defense') {
      $('#defense_text').html(result.defense_text);
      redrawChart();
    } else {
      redrawChart();
      $('#alarm_text').html('');
      $('#defense_text').html('');
    }
    
  });
}

function redrawChart() {
  moveOption.series[0].data = buildAttackLines();
  moveOption.series[1].data = buildAttackLines();
  moveOption.series[2].data = buildAreaScatter();
  attackChart.setOption(moveOption);
}

setInterval(getWebpageJsonAndRedraw, 1000);
</script>
</html>
